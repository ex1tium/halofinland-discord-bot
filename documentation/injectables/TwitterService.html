<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>halofinland-bot documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	   <link rel="stylesheet" href="../styles/style.css">
        <link rel="stylesheet" href="../styles/dark.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top visible-xs">
            <a href="../" class="navbar-brand">halofinland-bot documentation</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content injectable">
                   <div class="content-data">








<ol class="breadcrumb">
  <li>Injectables</li>
  <li >TwitterService</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="active">
            <a href="#info" role="tab" id="info-tab" data-toggle="tab" data-link="info">Info</a>
        </li>
        <li >
            <a href="#source" role="tab" id="source-tab" data-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="c-info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/services/twitter.service.ts</code>
        </p>





            <section>
    <h3 id="index">Index</h3>
    <table class="table table-sm table-bordered index-table">
        <tbody>
                <tr>
                    <td class="col-md-4">
                        <h6><b>Properties</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#_client" >_client</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#_haloSupportTweets" >_haloSupportTweets</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                    <span class="modifier">Readonly</span>
                                <a href="#_logger" >_logger</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#_twitterAllowedSearchAuthorIds" >_twitterAllowedSearchAuthorIds</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#_twitterUsers" >_twitterUsers</a>
                            </li>
                        </ul>
                    </td>
                </tr>

                <tr>
                    <td class="col-md-4">
                        <h6><b>Methods</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#constructEmbedTweetMessage" >constructEmbedTweetMessage</a>
                            </li>
                            <li>
                                <a href="#delay" >delay</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#init" >init</a>
                            </li>
                            <li>
                                <a href="#next" >next</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#pollHaloSupportTweets" >pollHaloSupportTweets</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#recordTweet" >recordTweet</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#sendChannel" >sendChannel</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#upsertTweet" >upsertTweet</a>
                            </li>
                        </ul>
                    </td>
                </tr>





                    <tr>
                        <td class="col-md-4">
                            <h6><b>Accessors</b></h6>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <ul class="index-list">
                                <li>
                                    <a href="#newTweets$" >newTweets$</a>
                                </li>
                            </ul>
                        </td>
                    </tr>
        </tbody>
    </table>
</section>

            <section>
    <h3 id="constructor">Constructor</h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
<code>constructor(_configService: ConfigService, _prismaService: <a href="../injectables/PrismaService.html" target="_self">PrismaService</a>, _discordProvider: DiscordClientProvider)</code>
                    </td>
                </tr>
                        <tr>
                            <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="31" class="link-to-prism">src/services/twitter.service.ts:31</a></div>
                            </td>
                        </tr>

                <tr>
                    <td class="col-md-4">
                            <div class="io-description"><p>It creates a new instance of the TwitterApi class.</p>
</div>
                            <div>
                                    <b>Parameters :</b>
                                    <table class="params">
                                        <thead>
                                            <tr>
                                                <td>Name</td>
                                                    <td>Type</td>
                                                <td>Optional</td>
                                                    <td>Description</td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                                <tr>
                                                        <td>_configService</td>
                                                  
                                                        <td>
                                                                    <code>ConfigService</code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                        <td>
                                                                <ul>
<li>ConfigService</li>
</ul>

                                                        </td>
                                                </tr>
                                                <tr>
                                                        <td>_prismaService</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/PrismaService.html" target="_self" >PrismaService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                        <td>
                                                                <ul>
<li>The PrismaService is used to interact with the database.</li>
</ul>

                                                        </td>
                                                </tr>
                                                <tr>
                                                        <td>_discordProvider</td>
                                                  
                                                        <td>
                                                                    <code>DiscordClientProvider</code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                        <td>
                                                                <ul>
<li>DiscordClientProvider</li>
</ul>

                                                        </td>
                                                </tr>
                                        </tbody>
                                    </table>
                            </div>
                    </td>
                </tr>
            </tbody>
        </table>
</section>

            <section>
    
    <h3 id="methods">
        Methods
    </h3>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="constructEmbedTweetMessage"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>constructEmbedTweetMessage</b></span>
                        <a href="#constructEmbedTweetMessage"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>constructEmbedTweetMessage(tweet: TweetV2)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="152"
                            class="link-to-prism">src/services/twitter.service.ts:152</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>It constructs a message embed for a tweet.</p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                    <td>Description</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>tweet</td>
                                    <td>
                                            <code>TweetV2</code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                    <td>
                                        <ul>
<li>TweetV2</li>
</ul>

                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>unknown</code>

                    </div>
                    <div class="io-description">
                        <p>A promise.</p>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="delay"></a>
                    <span class="name">
                        <span ><b>delay</b></span>
                        <a href="#delay"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>delay(ms: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="324"
                            class="link-to-prism">src/services/twitter.service.ts:324</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Delay(ms: number) =&gt; Promise<void></p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                    <td>Description</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>ms</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                    <td>
                                        <ul>
<li>number</li>
</ul>

                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                    </div>
                    <div class="io-description">
                        <p>Nothing.</p>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="init"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>init</b></span>
                        <a href="#init"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>init()</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="61"
                            class="link-to-prism">src/services/twitter.service.ts:61</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>It searches for users with the given IDs and returns them.</p>
</div>

                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>unknown</code>

                    </div>
                    <div class="io-description">
                        <p>The twitter users.</p>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="next"></a>
                    <span class="name">
                        <span ><b>next</b></span>
                        <a href="#next"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>next(tweets: TweetV2[])</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="112"
                            class="link-to-prism">src/services/twitter.service.ts:112</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>It takes in an array of tweets and emits a new array of tweets</p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                    <td>Description</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>tweets</td>
                                    <td>
                                            <code>TweetV2[]</code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                    <td>
                                        <ul>
<li>TweetV2[]</li>
</ul>

                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="pollHaloSupportTweets"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>pollHaloSupportTweets</b></span>
                        <a href="#pollHaloSupportTweets"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>pollHaloSupportTweets()</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="202"
                            class="link-to-prism">src/services/twitter.service.ts:202</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>It searches for tweets that contain the words &quot;patch&quot;, &quot;release&quot;, &quot;update&quot;, &quot;problem&quot;, or &quot;issue&quot;
and then checks to see if the tweet is from a user that we have allowed to tweet. If it is, it then
checks to see if the tweet is already in our database. If it is not, it then adds the tweet to our
database and then sends a message to the channels that we have configured</p>
</div>

                    <div class="io-description">
                        <b>Returns : </b>    <code>unknown</code>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="recordTweet"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>recordTweet</b></span>
                        <a href="#recordTweet"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>recordTweet(tweetData: TweetV2)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="268"
                            class="link-to-prism">src/services/twitter.service.ts:268</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Create a new tweet record in the database</p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                    <td>Description</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>tweetData</td>
                                    <td>
                                            <code>TweetV2</code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                    <td>
                                        <ul>
<li>TweetV2</li>
</ul>

                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>unknown</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="sendChannel"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>sendChannel</b></span>
                        <a href="#sendChannel"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>sendChannel(channelId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, tweet: TweetV2)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="123"
                            class="link-to-prism">src/services/twitter.service.ts:123</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>It sends a message to a Discord channel.</p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                    <td>Description</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>channelId</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                    <td>
                                        <ul>
<li>The ID of the channel to send the message to.</li>
</ul>

                                    </td>
                                </tr>
                                <tr>
                                    <td>tweet</td>
                                    <td>
                                            <code>TweetV2</code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                    <td>
                                        <ul>
<li>TweetV2</li>
</ul>

                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>unknown</code>

                    </div>
                    <div class="io-description">
                        <p>Nothing.</p>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="upsertTweet"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>upsertTweet</b></span>
                        <a href="#upsertTweet"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>upsertTweet(tweetData: TweetV2)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="293"
                            class="link-to-prism">src/services/twitter.service.ts:293</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Upsert a tweet</p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                    <td>Description</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>tweetData</td>
                                    <td>
                                            <code>TweetV2</code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                    <td>
                                        <ul>
<li>TweetV2</li>
</ul>

                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>unknown</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</section>
            <section>
    
    <h3 id="inputs">
        Properties
    </h3>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="_client"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                        <span ><b>_client</b></span>
                        <a href="#_client"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>    <code>TwitterApi</code>

                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="24" class="link-to-prism">src/services/twitter.service.ts:24</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="_haloSupportTweets"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                        <span ><b>_haloSupportTweets</b></span>
                        <a href="#_haloSupportTweets"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>    <code>BehaviorSubject&lt;TweetV2[]&gt;</code>

                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Default value : </i><code>new BehaviorSubject(
    null,
  )</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="26" class="link-to-prism">src/services/twitter.service.ts:26</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="_logger"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                            <span class="modifier">Readonly</span>
                        <span ><b>_logger</b></span>
                        <a href="#_logger"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Default value : </i><code>new Logger(TwitterService.name)</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="23" class="link-to-prism">src/services/twitter.service.ts:23</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="_twitterAllowedSearchAuthorIds"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                        <span ><b>_twitterAllowedSearchAuthorIds</b></span>
                        <a href="#_twitterAllowedSearchAuthorIds"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>    <code>string[]</code>

                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Default value : </i><code>[]</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="30" class="link-to-prism">src/services/twitter.service.ts:30</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="_twitterUsers"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                        <span ><b>_twitterUsers</b></span>
                        <a href="#_twitterUsers"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>    <code>UserV2[]</code>

                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Default value : </i><code>[]</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="31" class="link-to-prism">src/services/twitter.service.ts:31</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
</section>

            <section>
    <h3 id="accessors">
        Accessors
    </h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="newTweets$"></a>
                        <span class="name"><b>newTweets$</b><a href="#newTweets$"><span class="icon ion-ios-link"></span></a></span>
                    </td>
                </tr>

                <tr>
                    <td class="col-md-4">
                        <span class="accessor"><b>get</b><code>newTweets$()</code></span>
                    </td>
                </tr>
                            <tr>
                                <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="104" class="link-to-prism">src/services/twitter.service.ts:104</a></div>
                                </td>
                            </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>It returns an observable that emits the tweets that are currently in the store.</p>
</div>

                                <div>
                                </div>
                        </td>
                    </tr>

            </tbody>
        </table>
</section>
    </div>


    <div class="tab-pane fade  tab-source-code" id="c-source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { Injectable, Logger } from &#x27;@nestjs/common&#x27;;
import { ConfigService } from &#x27;@nestjs/config&#x27;;
import {
  ETwitterStreamEvent,
  TweetStream,
  TweetV2,
  TweetV2SingleResult,
  TwitterApi,
  TwitterApiv2,
  UserV2,
  UserV2Result,
} from &#x27;twitter-api-v2&#x27;;

import { BehaviorSubject, from, Observable } from &#x27;rxjs&#x27;;
import { PrismaService } from &#x27;./prisma.service&#x27;;
import { Cron, CronExpression } from &#x27;@nestjs/schedule&#x27;;
import { DiscordClientProvider } from &#x27;@discord-nestjs/core&#x27;;
import { TextChannel, MessageEmbed } from &#x27;discord.js&#x27;;
import { format } from &#x27;date-fns&#x27;;

@Injectable()
export class TwitterService {
  private readonly _logger &#x3D; new Logger(TwitterService.name);
  private _client: TwitterApi;

  private _haloSupportTweets: BehaviorSubject&lt;TweetV2[]&gt; &#x3D; new BehaviorSubject(
    null,
  );

  private _twitterAllowedSearchAuthorIds: string[] &#x3D; [];
  private _twitterUsers: UserV2[] &#x3D; [];

  /**
   * It creates a new instance of the TwitterApi class.
   * @param {ConfigService} _configService - ConfigService
   * @param {PrismaService} _prismaService - The PrismaService is used to interact with the database.
   * @param {DiscordClientProvider} _discordProvider - DiscordClientProvider
   */
  constructor(
    private _configService: ConfigService,
    private _prismaService: PrismaService,
    private _discordProvider: DiscordClientProvider,
  ) {
    this._twitterAllowedSearchAuthorIds &#x3D; this._configService.get(&#x27;twitterAllowedSearchAuthorIds&#x27;).split(&quot;, &quot;);

    // console.debug(&#x27;twitterAllowedSearchAuthorIds&#x27;, this.twitterAllowedSearchAuthorIds)

    this._client &#x3D; new TwitterApi(
      this._configService.get(&#x27;twitterBearerToken&#x27;),
    );

    // this._logger.debug(&#x60;twitter client:  ${JSON.stringify(this._client)}&#x60;);
  }



  /**
   * It searches for users with the given IDs and returns them.
   * @returns The twitter users.
   */
  async init() {
    try {

      this._twitterUsers &#x3D; [];
      let foundError: boolean &#x3D; false;
      const notFoundUserIds: string[] &#x3D; [];

      for (const twitterUserId of this._twitterAllowedSearchAuthorIds) {
        const user &#x3D; await this._client.v2.user(twitterUserId);

        if (user.data &amp;&amp; !user.errors) {
          this._logger.verbose(&#x60;twitter user: ${JSON.stringify(user)}&#x60;);
          this._twitterUsers.push(user.data)
        } else if (user.errors) {
          foundError &#x3D; true;
          notFoundUserIds.push(user.errors[0].value)
        }
      }

      await this.pollHaloSupportTweets().catch((error) &#x3D;&gt; {
        this._logger.error(error)
      })

      // this._logger.verbose(&#x60;twitter users: ${JSON.stringify(this._twitterUsers)}&#x60;);

      if (foundError) {
        return Promise.reject(&#x60;User with IDs ${notFoundUserIds} not a valid Twitter User&#x60;)
      } else {
        return this._twitterUsers;
      }
    } catch (error) {
      if (error &amp;&amp; error.stack) {
        return Promise.reject(this._logger.error(error.stack));
      } else {
        return Promise.reject(this._logger.error(error));
      }
    }
  }

  /**
   * It returns an observable that emits the tweets that are currently in the store.
   * @returns An Observable of tweets.
   */
  get newTweets$() {
    return this._haloSupportTweets.asObservable();
  }

  /**
   * It takes in an array of tweets and emits a new array of tweets
   * @param {TweetV2[]} tweets - TweetV2[]
   */
  next(tweets: TweetV2[]) {
    this._haloSupportTweets.next([...tweets]);
  }


  /**
   * It sends a message to a Discord channel.
   * @param {string} channelId - The ID of the channel to send the message to.
   * @param {TweetV2} tweet - TweetV2
   * @returns Nothing.
   */
  async sendChannel(channelId: string, tweet: TweetV2) {
    try {
      const channel &#x3D; (await this._discordProvider
        .getClient()
        .channels.fetch(channelId)) as TextChannel;
      const createMessage &#x3D; await this.constructEmbedTweetMessage(tweet).catch((error) &#x3D;&gt; {
        this._logger.error(error);
      });

      if (createMessage) {
        return channel.send({ embeds: [createMessage] });
      } else {
        return Promise.reject(&#x60;Problem sending message to channel ${channel.name}.&#x60;);
      }
    } catch (error) {
      if (error &amp;&amp; error.stack) {
        return Promise.reject(this._logger.error(error.stack));
      } else {
        return Promise.reject(this._logger.error(error));
      }
    }
  }


  /**
   * It constructs a message embed for a tweet.
   * @param {TweetV2} tweet - TweetV2
   * @returns A promise.
   */
  async constructEmbedTweetMessage(tweet: TweetV2) {
    try {

      if (this._twitterUsers.some(user &#x3D;&gt; user.id &#x3D;&#x3D;&#x3D; tweet.author_id)) {

        const tweetAuthor &#x3D; this._twitterUsers.filter((user) &#x3D;&gt; user.id &#x3D;&#x3D;&#x3D; tweet.author_id)[0];

        const embedTweet &#x3D; new MessageEmbed()
          .setURL(&#x60;https://twitter.com/i/web/status/${tweet.id}&#x60;)
          .setAuthor({
            name: &#x60;@${tweetAuthor.username}&#x60;,
            iconURL: null,
            url: &#x60;https://twitter.com/${tweetAuthor.username}&#x60;,
          })
          .addFields(
            {
              name: &#x27;Tweet&#x27;,
              value: tweet.text,
            },
            {
              name: &#x27;Actions&#x27;,
              value: &#x60;[Open Tweet](https://twitter.com/i/web/status/${tweet.id})&#x60;,
            },
          )
          .setTimestamp(new Date(tweet.created_at))
          .setFooter({
            text: format(new Date(tweet.created_at), &#x27;HH:mm&#x27;),
          });
        // .setURL(&#x60;https://twitter.com/i/web/status/${tweet.id}&#x60;)
        return embedTweet;
      } else {
        Promise.reject(&#x27;Could not find details for tweet author. Author twitter ID is not included in .env configuration TWITTER_ALLOWED_SEARCH_AUTHOR_IDS. Details for these users are loaded in init() function of TwitterService&#x27;)
      }


    } catch (error) {
      if (error &amp;&amp; error.stack) {
        return Promise.reject(this._logger.error(error.stack));
      } else {
        return Promise.reject(this._logger.error(error));
      }
    }
  }

  /**
   * It searches for tweets that contain the words &quot;patch&quot;, &quot;release&quot;, &quot;update&quot;, &quot;problem&quot;, or &quot;issue&quot;
   * and then checks to see if the tweet is from a user that we have allowed to tweet. If it is, it then
   * checks to see if the tweet is already in our database. If it is not, it then adds the tweet to our
   * database and then sends a message to the channels that we have configured
   */
  async pollHaloSupportTweets() {
    try {
      const search &#x3D; await this._client.v2.search(
        &#x27;from:HaloSupport (&quot;patch&quot; OR &quot;release&quot; OR &quot;update&quot; OR &quot;problem&quot; OR &quot;issue&quot;)&#x27;,
        {
          &#x27;tweet.fields&#x27;: [&#x27;created_at&#x27;, &#x27;id&#x27;, &#x27;author_id&#x27;, &#x27;source&#x27;],
        },
      );

      this._logger.debug(&#x27;searching for new tweets&#x27;);

      // this._logger.debug(&#x27;search&#x27;, JSON.stringify(search))
      const newTweets: TweetV2[] &#x3D; [];

      const sortData &#x3D; search.data.data.sort((a, b) &#x3D;&gt; {
        return (
          new Date(a.created_at).valueOf() - new Date(b.created_at).valueOf()
        );
      });

      for (let i &#x3D; 0; i &lt; sortData.length; i++) {
        const tweet &#x3D; sortData[i];

        if (
          this._twitterAllowedSearchAuthorIds.some(
            (id) &#x3D;&gt; id &#x3D;&#x3D; tweet.author_id,
          )
        ) {
          const found &#x3D; await this._prismaService.tweet.findUnique({
            where: {
              tweet_id: tweet.id,
            },
          });

          if (!found) {
            await this.recordTweet(tweet);
            newTweets.push(tweet);

            const supportTweetChannelIds: string[] &#x3D; this._configService.get(&#x27;supportTweetChannelIds&#x27;).split(&#x27;, &#x27;);

            for (let i &#x3D; 0; i &lt; supportTweetChannelIds.length; i++) {
              const channelId &#x3D; supportTweetChannelIds[i];

              await this.delay(500)
              this.sendChannel(channelId, tweet)
            }

            // console.log(&#x27;found new tweet&#x27;, tweet);
          }
        }
      }
      this.next(newTweets);
      return newTweets;
    } catch (error) {
      if (error &amp;&amp; error.stack) {
        return Promise.reject(this._logger.error(error.stack));
      } else {
        return Promise.reject(this._logger.error(error));
      }
    }
  }

  /**
   * Create a new tweet record in the database
   * @param {TweetV2} tweetData - TweetV2
   */
  async recordTweet(tweetData: TweetV2) {
    try {
      const record &#x3D; await this._prismaService.tweet.create({
        data: {
          tweet_id: tweetData.id,
          text: tweetData.text,
          created_at: tweetData.created_at,
          author_id: tweetData.author_id,
        },
      });

      return record;
    } catch (error) {
      if (error &amp;&amp; error.stack) {
        return Promise.reject(this._logger.error(error.stack));
      } else {
        return Promise.reject(this._logger.error(error));
      }
    }
  }

  /**
   * Upsert a tweet
   * @param {TweetV2} tweetData - TweetV2
   */
  async upsertTweet(tweetData: TweetV2) {
    try {
      const tweet &#x3D; await this._prismaService.tweet.upsert({
        where: {
          tweet_id: tweetData.id,
        },
        update: {},
        create: {
          tweet_id: tweetData.id,
          text: tweetData.text,
          author_id: tweetData.author_id,
          created_at: tweetData.created_at,
        },
      });

      // this._logger.verbose(&#x60;tweet: ${JSON.stringify(tweet)}&#x60;)
      return tweet;
    } catch (error) {
      if (error &amp;&amp; error.stack) {
        return Promise.reject(this._logger.error(error.stack));
      } else {
        return Promise.reject(this._logger.error(error));
      }
    }
  }

  /**
   * Delay(ms: number) &#x3D;&gt; Promise&lt;void&gt;
   * @param {number} ms - number
   * @returns Nothing.
   */
  delay(ms: number) {
    return new Promise(resolve &#x3D;&gt; setTimeout(resolve, ms));
  }
}
</code></pre>
    </div>

</div>












                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

          <label class="dark-mode-switch">
               <input type="checkbox">
               <span class="slider">
                    <svg class="slider-icon" viewBox="0 0 24 24" fill="none" height="20" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" width="20" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path>
                    </svg>
               </span>
          </label>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'injectable';
            var COMPODOC_CURRENT_PAGE_URL = 'TwitterService.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>

       <script src="../js/menu-wc.js" defer></script>
       <script nomodule src="../js/menu-wc_es5.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
